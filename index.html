<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <title>Darfield earthquake timeline</title>
    <script src="http://maps.google.com/maps?file=api&amp;v=2&amp;sensor=false&amp;key=ABQIAAAA69DfOEx1y1daALUHQUXAXBTTo2ugwXF-rwj8SU4JkiH73zqXbRQctklcY5DNaxz_swtlbgPjP3YmXg" type="text/javascript"></script>
    <script type="text/javascript" src="http://static.simile.mit.edu/timeline/api/timeline-api.js"></script>
    <script src="timemap_full.pack.js" type="text/javascript"></script>
    <script type="text/javascript">

var tm;

function onLoad() {
    window.magmin = 3;
    window.magmax = 8;

    tm = TimeMap.init({
        mapId: "map",               // Id of map div element (required)
        timelineId: "timeline",     // Id of timeline div element (required) 
        options: {
            eventIconPath: "images/",
        },
        datasets: [
            {
                title: "Darfield Earthquake",
                theme: "red",
                type: "kml",     // Data to be loaded in KML - must be a local URL
                options: {
                    url: "earthquakes.kml",
                    extendedData: ["date","z","mag","info"],
                    infoTemplate: '<strong>Magnitude:</strong> {{mag}}<br/>' +
                                  '<strong>Depth:</strong> {{z}}km<br/>' +
                                  '<strong>Date (UTC):</strong> {{date}}<br/>' +
                                  '<strong>Info:</strong> {{info}}'
                }
            }
        ],
        bandInfo: [
            {
               width:          "70%", 
               intervalUnit:   Timeline.DateTime.HOUR, 
		           intervalPixels: 400,
               timeZone: 12
            },
            {
               width:          "30%", 
               intervalUnit:   Timeline.DateTime.DAY, 
		           intervalPixels: 300,
               showEventText:  false,
               timeZone: 12
            }
        ]
    });

    tm.addFilter("map", TimeMap.filters.isMagnitude);
    tm.addFilter("timeline", TimeMap.filters.isMagnitude);
}

TimeMap.filters.isMagnitude = function(item) {
  if (!window.magmin && !window.magmax) {
    return true;
  }
  return (Number(item.opts.mag) > window.magmin) && (Number(item.opts.mag) < window.magmax);
}

function setMagnitude(select) {
  if (select.id == 'magmin') {
    window.magmin = Number(select.options[select.selectedIndex].value);
  } else if (select.id == 'magmax') {
    window.magmax = Number(select.options[select.selectedIndex].value);
  }
  tm.filter('map');
  tm.filter('timeline');
}
    </script>
	  <link href="styles.css" type="text/css" rel="stylesheet"/>
    <style>
    div#timelinecontainer{ height: 100px; }
    div#mapcontainer{ height: 300px; }
    </style>
  </head>

  <body onload="onLoad();" onunload="GUnload();">
    <div id="help">
    <h1>Darfield earthquake timeline</h1>
    <p>
      This map shows a timeline of the main quake and aftershocks from the
      Darfield Earthquake of 4th September 2010.  Uses the excellent data from
      <a href="http://geonet.org.nz/">GeoNet</a> and Nick Rab's <a
        href="http://code.google.com/p/timemap">timemap</a> javascript library.
    </p>
    <p>
    Drag the grey bars above the map to change the time.
    <p>
    Coders, <a
      href="http://github.com/malclocke/darfield-earthquake-timeline">fork
      it on github</a>, improvements gratefully received.
    </p>
    </div>
    <form>
      <fieldset>
        <legend>Filters</legend>
        <label for="magmin">Min magnitude</label>
        <select id="magmin" onChange="setMagnitude(this)">
          <option value="3" selected="true">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
          <option value="6">6</option>
          <option value="7">7</option>
        </select>
        <label for="magmax">Max magnitude</label>
        <select id="magmax" onChange="setMagnitude(this)">
          <option value="4">4</option>
          <option value="5">5</option>
          <option value="6">6</option>
          <option value="7">7</option>
          <option value="8" selected="true">8</option>
        </select>
      </fieldset>
    </form>
    <div id="timemap">
        <div id="timelinecontainer">
          <div id="timeline"></div>
        </div>
        <div id="mapcontainer">
          <div id="map"></div>
        </div>
    </div>
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-12394165-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
  </body>
</html>
